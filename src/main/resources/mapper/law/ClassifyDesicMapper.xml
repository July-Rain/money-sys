<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lawschool.dao.law.ClassifyDesicDao">
  <resultMap id="BaseResultMap" type="com.lawschool.beans.law.ClassifyDesicEntity">
    <id column="ID" jdbcType="NVARCHAR" property="id" />
    <result column="LAW_CODE" jdbcType="NVARCHAR" property="lawCode" />
    <result column="LAW_TITLE" jdbcType="NVARCHAR" property="lawTitle" />
    <result column="ISSUE_TIME" jdbcType="TIMESTAMP" property="issueTime" />
    <result column="LIB_CODE" jdbcType="NVARCHAR" property="libCode" />
    <result column="DEL_FLAG" jdbcType="DECIMAL" property="delFlag" />
    <result column="ORDER_NUM" jdbcType="DECIMAL" property="orderNum" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
    <result column="CALSSIFY_CODE" jdbcType="NVARCHAR" property="calssifyCode" />
    <result column="STATUS" jdbcType="NVARCHAR" property="status" />
    <result column="ISSUE_ORG" jdbcType="NVARCHAR" property="issueOrg" />
      <result column="recordId" jdbcType="NVARCHAR" property="recordId" />
  </resultMap>
  <select id="queryListByTask" resultMap="BaseResultMap" parameterType="com.lawschool.beans.law.TaskDesicEntity">
        SELECT
            c. ID,
            c.LAW_CODE,
            c.LAW_TITLE,
            c.ISSUE_ORG,
            c.ISSUE_TIME,
            c.LIB_ID,
            c.status,
			r.id as recordId
        FROM
            (
                SELECT
                DISTINCT(T.id),
                    T .DATA_ID
                FROM
                    LAW_TASKS_DESIC T
                WHERE
                    T .TASK_ID = #{taskId}
                AND T .INFO_TYPE = #{infoType} START WITH T .INFO_ID = #{infoId} CONNECT BY PRIOR T .INFO_ID = T .INFO_PARENT_ID
            ) M
        INNER JOIN LAW_CLASSIFY_DESIC c ON M .DATA_ID = c. ID
        LEFT JOIN LAW_STU_RECORD r ON m.DATA_ID=r.stu_id and r.task_id=#{taskId} and r.user_id=#{userId}
  </select>
    <select id="countListByTask" resultType="java.lang.Integer" parameterType="com.lawschool.beans.law.TaskDesicEntity">
        SELECT
            count(1)
        FROM
            (
                SELECT
                DISTINCT(T.id),
                    T .DATA_ID
                FROM
                    LAW_TASKS_DESIC T
                WHERE
                    T .TASK_ID = #{taskId}
                AND T .INFO_TYPE = #{infoType} START WITH T .INFO_ID = #{infoId} CONNECT BY PRIOR T .INFO_ID = T .INFO_PARENT_ID
            ) M
        INNER JOIN LAW_CLASSIFY_DESIC c ON M .DATA_ID = c. ID
        LEFT JOIN LAW_STU_RECORD r ON m.DATA_ID=r.stu_id and r.task_id=#{taskId} and r.user_id=#{userId}
  </select>
</mapper>